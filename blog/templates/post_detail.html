{% extends 'base.html' %}
{% block title %}{{ object.title }}{% endblock %}
{% block content %}
<article>
  <!-- TÃ­tulo y autor -->
  <h1 class="mb-1">{{ object.title }}</h1>
  <small class="text-muted">
    por 
    <a href="{% url 'blog:profile_detail' object.author.username %}" class="text-decoration-none text-info">
      <strong>{{ object.author.username }}</strong>
    </a> 
    Â· {{ object.created|date:"d/m/Y H:i" }}
  </small>

  <!-- Promedio -->
  <div class="my-2">
    â­ Promedio: <strong>{{ object.average_rating }}</strong>
  </div>

  <!-- Imagen de portada -->
  {% if object.cover %}
    <img src="{{ object.cover.url }}" class="img-fluid my-3 rounded shadow-sm post-img" alt="cover">
  {% endif %}

  <!-- Contenido -->
  <div class="mt-3">{{ object.content|safe }}</div>

  <!-- Botones de autor -->
  {% if user == object.author %}
    <a href="{% url 'blog:post_update' object.slug %}" class="btn btn-sm btn-primary mt-2">âœï¸ Editar</a>
    <a href="{% url 'blog:post_delete' object.slug %}" class="btn btn-sm btn-danger mt-2">ğŸ—‘ï¸ Eliminar</a>
  {% endif %}

  <hr>

  <!-- Formulario de reseÃ±a -->
  <h4>Deja tu reseÃ±a</h4>
  {% if user.is_authenticated %}
    <form method="post" action="{% url 'blog:add_review' object.slug %}" class="mb-4">
      {% csrf_token %}

      <div class="mb-3">
        <label for="id_rating" class="form-label">Tu calificaciÃ³n (1 a 5)</label>
        <select name="rating" id="id_rating" class="form-select" required>
          <option value="">Selecciona...</option>
          <option value="1">â­ 1 - Muy malo</option>
          <option value="2">â­â­ 2 - Malo</option>
          <option value="3">â­â­â­ 3 - Regular</option>
          <option value="4">â­â­â­â­ 4 - Bueno</option>
          <option value="5">â­â­â­â­â­ 5 - Excelente</option>
        </select>
      </div>

      <div class="mb-3">
        <label for="id_comment" class="form-label">Comentario</label>
        <textarea name="comment" id="id_comment" rows="3" class="form-control"
                  placeholder="Escribe tu opiniÃ³n..."></textarea>
      </div>

      <button class="btn btn-success w-100">Enviar</button>
    </form>
  {% else %}
    <p><a href="{% url 'blog:login' %}">Inicia sesiÃ³n</a> para calificar y comentar.</p>
  {% endif %}

  <hr>

  <!-- Lista de reseÃ±as -->
  <h4>ReseÃ±as</h4>
  {% for r in object.reviews.all %}
    <div class="border p-3 my-3 rounded bg-dark text-light shadow-sm">
      <div class="d-flex justify-content-between">
        <!-- Nombre con link al perfil -->
        <a href="{% url 'blog:profile_detail' r.user.username %}" class="text-decoration-none text-info">
          <strong>{{ r.user.username }}</strong>
        </a>
        <small class="text-muted">{{ r.created|date:"d/m/Y H:i" }}</small>
      </div>

      <div class="mt-1">â­ {{ r.rating }}</div>
      <p class="mb-2">{{ r.comment }}</p>

      <!-- Botones Like/Dislike -->
      <div class="mt-2">
        <a href="{% url 'blog:vote_review' r.id 'like' %}" class="btn btn-sm btn-outline-success me-2">
          ğŸ‘ Like ({{ r.likes_count }})
        </a>
        <a href="{% url 'blog:vote_review' r.id 'dislike' %}" class="btn btn-sm btn-outline-danger">
          ğŸ‘ Dislike ({{ r.dislikes_count }})
        </a>
      </div>
    </div>
  {% empty %}
    <p class="text-muted">No hay reseÃ±as.</p>
  {% endfor %}
</article>
{% endblock %}
